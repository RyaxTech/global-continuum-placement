{"appName": "", "owner": "", "SoftwareImage": "", "app_id": "app0", "flows": [{"flowID": "3dc59d6aea6e35a4", "flowName": "Hello_DMS", "type": "Flow", "executorMode": "NoderedFunction", "artifact": "registry.apps.ocphub.physics-faas.eu/custom/george:101", "native": false, "annotations": {"memory": "512", "locality": "aws", "timeout": "150000", "goal": "performance", "importance": "high", "dms_job_id": "ss", "dms_location": "https://openwhisk.apps.ocphub.physics-faas.eu/api/v1", "dms_namespace": "wp4namespace", "dms_operation": "dms-w", "dms_pocket_dst_file": "dd", "dms_size": "10"}, "hasAction": "", "functions": [{"id": "2347840f70beb926", "displayName": "hello world", "type": "Function", "code": "function main(msg){\nconsole.log(msg);\nmsg.payload='hello '+msg.payload.value.name;\nreturn msg;}", "sequence": 1, "annotations": {}, "allocations": ["Cluster_3", "Cluster_4"]}, {"id": "223f577e6b96a222", "displayName": "write", "type": "Function", "code": "function main(msg){var data=msg.payload;\nmsg.payload={};\nmsg.payload.data=data;\nmsg.data=data;\nreturn msg;}", "sequence": 1, "annotations": {}, "allocations": ["Cluster_3", "Cluster_4"]}, {"id": "3402a8de3203b61c", "displayName": "results", "type": "Function", "code": "function main(msg){var input=msg.payload;\n\nmsg.payload={};\nmsg.payload.dmsResult=input.response.result;\nmsg.payload.data=msg.data;\nreturn msg;}", "sequence": 1, "annotations": {}, "allocations": ["Cluster_3", "Cluster_4"]}, {"id": "7d194c10.33b51c", "displayName": "defaults+activation id", "type": "Function", "code": "function main(msg){\nif (msg.hasOwnProperty('maxAttempts')){\n    msg.iterations=msg.maxAttempts;\n} else {\n    msg.iterations=env.get('maxAttempts');\n}\n//needed to reset the iterations after function chaining\nmsg.defaultAttempts=msg.iterations;\n\nif (msg.hasOwnProperty('pollPeriod')){\n    \n} else {\n    msg.pollPeriod=env.get('pollPeriod');\n}\n\nif (msg.hasOwnProperty('method')){\n    \n} else {\n    msg.method=env.get('method');\n}\n\nif (msg.hasOwnProperty('url')){\n    \n} else {\n    msg.url=env.get('url');\n}\n\nif (msg.hasOwnProperty('retryCode')){\n    \n} else {\n    msg.retryCode=env.get('retryCode');\n}\n\nif (msg.hasOwnProperty('acceptCode')){\n    \n} else {\n    msg.acceptCode=env.get('acceptCode');\n}\n\nif (msg.hasOwnProperty('creds')){\n    \n} else {\n    msg.creds=env.get('creds');\n}\n\nif (msg.hasOwnProperty('functionChain')){\n    \n} else {\n    msg.functionChain=env.get('functionChain');\n}\n\nif (msg.hasOwnProperty('inputData')){\n    if (msg.inputData.hasOwnProperty('creds')){\n        msg.creds=msg.inputData.creds;\n    }\n}\n\n\n\nmsg.delay=msg.pollPeriod;\nmsg.start=Date.now();\nreturn msg;}", "sequence": 1, "annotations": {}, "allocations": ["Cluster_3", "Cluster_4"]}, {"id": "4be3f205.3e8dc4", "displayName": "iterations--", "type": "Function", "code": "function main(msg){msg.iterations=msg.iterations-1;\nreturn msg;}", "sequence": 1, "annotations": {}, "allocations": ["Cluster_3", "Cluster_4"]}, {"id": "cad17b04.a2b4d8", "displayName": "add auth", "type": "Function", "code": "function main(msg){msg.headers={};\nvar auth = 'Basic ' + new Buffer(msg.creds).toString('base64');\nmsg.headers = {\n    \"Authorization\": auth\n}\n\nreturn msg;}", "sequence": 1, "annotations": {}, "allocations": ["Cluster_3", "Cluster_4"]}, {"id": "f2b7c4e4.a24c3", "displayName": "adapt to new activation", "type": "Function", "code": "function main(msg){\n\nmsg.url=msg.payload.response.result.newActivationIDURL;\nmsg.iterations=msg.defaultAttempts+1;\nconsole.log('IN ADAPTATION TO ACTIVATION',msg.url);\nreturn msg;}", "sequence": 1, "annotations": {}, "allocations": ["Cluster_3", "Cluster_4"]}, {"id": "1bbc6fa0.4879c", "displayName": "compare completion", "type": "Function", "code": "function main(msg){console.log('IN COMPARE COMPLETION',msg.payload.response);\nif (msg.payload.response.result.status==='Completed'){\n    return [msg,null];\n} else {\n    return [null,msg];\n}\n}", "sequence": 1, "annotations": {}, "allocations": ["Cluster_3", "Cluster_4"]}, {"id": "b1565887a7f49105", "displayName": "adapt", "type": "Function", "code": "function main(msg){\nif (msg.hasOwnProperty('dms_job_id')){\n} else {\n    msg.dms_job_id=env.get('dms_job_id');\n}\n\nif (msg.hasOwnProperty('dms_size')){\n} else {\n    msg.dms_size=env.get('dms_size');\n}\n\nif (msg.hasOwnProperty('dms_location')){\n} else {\n    msg.dms_location=env.get('dms_location');\n}\n\n\nif (msg.hasOwnProperty('dms_operation')){\n} else {\n    msg.dms_operation=env.get('dms_operation');\n}\n\nif (msg.hasOwnProperty('dms_namespace')){\n} else {\n    msg.namespace=env.get('dms_namespace');\n}\n\n\nif (msg.hasOwnProperty('dms_pocket_dst_file')){\n    //msg.dms_pocket_dst_file=msg.payload.dms_pocket_dst_file;\n} else {\n    msg.dms_pocket_dst_file=env.get('dms_pocket_dst_file');\n}\n\nif (msg.hasOwnProperty('creds')){\n    //msg.creds=msg.payload.dms_namespace;\n} else {\n    msg.creds=env.get('creds');\n}\n\n\nreturn msg;}", "sequence": 1, "annotations": {}, "allocations": ["Cluster_3", "Cluster_4"]}, {"id": "ccb0503362a32b2a", "displayName": "insert action invocation url and auth", "type": "Function", "code": "function main(msg){//msg.url='http://10.100.59.182:3233/api/v1/namespaces/guest/actions/dockeraction';\nmsg.url=msg.dms_location+'/namespaces/'+msg.namespace+'/actions/'+msg.dms_operation;\n\nconsole.log(msg.creds);\n//msg.creds='';\nmsg.headers={};\nvar auth = 'Basic ' + new Buffer(msg.creds).toString('base64');\nmsg.headers = {\n    \"Authorization\": auth\n}\n\n\nmsg.payload.jobid=msg.dms_job_id;\nmsg.payload.pocketFile= msg.dms_pocket_dst_file;\nmsg.payload.size=msg.dms_size;\n\nreturn msg;}", "sequence": 1, "annotations": {}, "allocations": ["Cluster_3", "Cluster_4"]}, {"id": "28af37e1ffcddb70", "displayName": "add OW activation id from reply", "type": "Function", "code": "function main(msg){\nmsg.activationID=msg.headers['x-openwhisk-activation-id'];\n\n//msg.url='http://10.100.59.182:3233/api/v1/namespaces/_/activations/'+msg.activationID;\n\nmsg.url=msg.dms_location+'/namespaces/'+msg.namespace+'/activations/'+msg.activationID;\n\nreturn msg;}", "sequence": 1, "annotations": {}, "allocations": ["Cluster_3", "Cluster_4"]}], "allocations": ["Cluster_3"]}, {"flowID": "d616400b75eac2fb", "flowName": "Choreographer Service", "type": "Flow", "executorMode": "Service", "artifact": "registry.apps.ocphub.physics-faas.eu/custom/george:99", "native": false, "annotations": {}, "hasAction": ["splitjoinFunction", "Hello_DMS", "HelloFunctionV2"], "functions": [{"id": "7418d9069a25f945", "displayName": "", "type": "Function", "code": "function main(msg){msg.payload={};\nmsg.payload.value={};\nmsg.payload.value.name='george';\nreturn msg;}", "sequence": 1, "annotations": {}, "allocations": ["Cluster_3", "Cluster_4"]}, {"id": "65a2fd77d5dd173b", "displayName": "", "type": "Function", "code": "function main(msg){msg.payload={};\nmsg.payload.value={};\nmsg.payload.value={\"values\":[\n    {'name':'george'},\n    {'name':'maria'},\n    {'name':'akis'},\n    {'name':'alex'}\n    ], \n    \"creds\":\"17dz39c2-62f7-3ed6-9b88-925ce4l3c104:459bO3xUERmNZ9v2BLU1dRYFpXlPkccOFqm31LdAsMgRU4VrNZ9dhORZGuLJGIqF\",\n    \"url\":\"https://openwhisk.apps.ocphub.physics-faas.eu/api/v1/namespaces/_/actions/HelloFunctionV2_b1d8d498-4197-420a-9ef8-56fec0c6d4ef.json?blocking=true\"\n};\n\n//msg.url='https://openwhisk.apps.ocphub.physics-faas.eu/api/v1/namespaces/_/actions/HelloFunctionV2_b1d8d498-4197-420a-9ef8-56fec0c6d4ef.json?blocking=true';\n\nreturn msg;}", "sequence": 1, "annotations": {}, "allocations": ["Cluster_3", "Cluster_4"]}, {"id": "b2131f1991cfb131", "displayName": "", "type": "Function", "code": "function main(msg){msg.payload={};\nmsg.payload.value={};\nmsg.payload.value.name='george';\nreturn msg;}", "sequence": 1, "annotations": {}, "allocations": ["Cluster_3", "Cluster_4"]}, {"id": "60d351e91c4f1f19", "displayName": "GET ENV OF ENDPOINT AND KEYS", "type": "Function", "code": "function main(msg){msg.url=env.get('OWendpoint');\nmsg.headers={};\nvar auth = 'Basic ' + new Buffer(env.get('token')).toString('base64');\nmsg.headers = {\n    \"Authorization\": auth\n}\n\nreturn msg;}", "sequence": 1, "annotations": {}, "allocations": ["Cluster_3", "Cluster_4"]}, {"id": "27c3b0af40ccb4e0", "displayName": "change url", "type": "Function", "code": "function main(msg){msg.headers={};\nmsg.url=env.get('')+'api/v1/namespaces/_/activations/';\nreturn msg;}", "sequence": 1, "annotations": {}, "allocations": ["Cluster_3", "Cluster_4"]}, {"id": "09223c13e462b3ba", "displayName": "", "type": "Function", "code": "function main(msg){const propnamevar=env.get('actionName')+'_OW_endpoint';\n//+1 for creds user:key\n\nvar globalenv = global.get(\"env2\");//needs to be set in the settings file, globalContext env2:process.env\nmsg.payload4=globalenv[propnamevar];\n\nreturn msg;}", "sequence": 1, "annotations": {}, "allocations": ["Cluster_3", "Cluster_4"]}, {"id": "7d194c10.33b51c", "displayName": "defaults+activation id", "type": "Function", "code": "function main(msg){\nif (msg.hasOwnProperty('maxAttempts')){\n    msg.iterations=msg.maxAttempts;\n} else {\n    msg.iterations=env.get('maxAttempts');\n}\n//needed to reset the iterations after function chaining\nmsg.defaultAttempts=msg.iterations;\n\nif (msg.hasOwnProperty('pollPeriod')){\n    \n} else {\n    msg.pollPeriod=env.get('pollPeriod');\n}\n\nif (msg.hasOwnProperty('method')){\n    \n} else {\n    msg.method=env.get('method');\n}\n\nif (msg.hasOwnProperty('url')){\n    \n} else {\n    msg.url=env.get('url');\n}\n\nif (msg.hasOwnProperty('retryCode')){\n    \n} else {\n    msg.retryCode=env.get('retryCode');\n}\n\nif (msg.hasOwnProperty('acceptCode')){\n    \n} else {\n    msg.acceptCode=env.get('acceptCode');\n}\n\nif (msg.hasOwnProperty('creds')){\n    \n} else {\n    msg.creds=env.get('creds');\n}\n\nif (msg.hasOwnProperty('functionChain')){\n    \n} else {\n    msg.functionChain=env.get('functionChain');\n}\n\nif (msg.hasOwnProperty('inputData')){\n    if (msg.inputData.hasOwnProperty('creds')){\n        msg.creds=msg.inputData.creds;\n    }\n}\n\n\n\nmsg.delay=msg.pollPeriod;\nmsg.start=Date.now();\nreturn msg;}", "sequence": 1, "annotations": {}, "allocations": ["Cluster_3", "Cluster_4"]}, {"id": "4be3f205.3e8dc4", "displayName": "iterations--", "type": "Function", "code": "function main(msg){msg.iterations=msg.iterations-1;\nreturn msg;}", "sequence": 1, "annotations": {}, "allocations": ["Cluster_3", "Cluster_4"]}, {"id": "cad17b04.a2b4d8", "displayName": "add auth", "type": "Function", "code": "function main(msg){msg.headers={};\nvar auth = 'Basic ' + new Buffer(msg.creds).toString('base64');\nmsg.headers = {\n    \"Authorization\": auth\n}\n\nreturn msg;}", "sequence": 1, "annotations": {}, "allocations": ["Cluster_3", "Cluster_4"]}, {"id": "f2b7c4e4.a24c3", "displayName": "adapt to new activation", "type": "Function", "code": "function main(msg){\n\nmsg.url=msg.payload.response.result.newActivationIDURL;\nmsg.iterations=msg.defaultAttempts+1;\nconsole.log('IN ADAPTATION TO ACTIVATION',msg.url);\nreturn msg;}", "sequence": 1, "annotations": {}, "allocations": ["Cluster_3", "Cluster_4"]}, {"id": "1bbc6fa0.4879c", "displayName": "compare completion", "type": "Function", "code": "function main(msg){console.log('IN COMPARE COMPLETION',msg.payload.response);\nif (msg.payload.response.result.status==='Completed'){\n    return [msg,null];\n} else {\n    return [null,msg];\n}\n}", "sequence": 1, "annotations": {}, "allocations": ["Cluster_3", "Cluster_4"]}], "allocations": ["Cluster_3", "Cluster_4"]}, {"flowID": "e98bf48d7a877d25", "flowName": "splitjoinFunction", "type": "Flow", "executorMode": "NoderedFunction", "artifact": "registry.apps.ocphub.physics-faas.eu/custom/george:103", "native": false, "annotations": {"affinity": "affinity"}, "hasAction": "", "functions": [{"id": "ce0ad53cb5c6ef33", "displayName": "", "type": "Function", "code": "function main(msg){//msg.action=msg.payload.value.action;\n\nmsg.url=msg.payload.value.url;\nmsg.creds=msg.payload.value.creds;\n\nmsg.oldpayload=msg.payload;\nmsg.payload={};\nmsg.payload=msg.oldpayload.value.values;\n\nmsg.headers={};\nvar auth = 'Basic ' + new Buffer(msg.creds).toString('base64');\nmsg.headers = {\n    \"Authorization\": auth\n}\nreturn msg;}", "sequence": 1, "annotations": {}, "allocations": ["Cluster_3", "Cluster_4"]}, {"id": "933bd2f642873790", "displayName": "", "type": "Function", "code": "function main(msg){msg.newpayload=msg.payload;\nmsg.payload=[];\nmsg.payload=msg.oldpayload;\nmsg.payload.value=msg.newpayload;\n\nmsg.payload.value.myvar=env.get('setsplit');\nreturn msg;}", "sequence": 1, "annotations": {}, "allocations": ["Cluster_3", "Cluster_4"]}], "allocations": ["Cluster_3", "Cluster_4"]}, {"flowID": "39ef55a8.55f96a", "flowName": "HelloFunctionV2", "type": "Flow", "executorMode": "NoderedFunction", "artifact": "registry.apps.ocphub.physics-faas.eu/custom/george:102", "native": false, "annotations": {"memory": "512", "locality": "aws", "timeout": "220000", "goal": "performance", "importance": "high"}, "hasAction": "", "functions": [{"id": "f52b7bec399e315a", "displayName": "hello world", "type": "Function", "code": "function main(msg){//console.log(msg);\n\nmsg.payload={'response':'hello '+msg.payload.value.name};\nreturn msg;}", "sequence": 1, "annotations": {}, "allocations": ["Cluster_3", "Cluster_4"]}], "allocations": ["Cluster_3"]}]}
